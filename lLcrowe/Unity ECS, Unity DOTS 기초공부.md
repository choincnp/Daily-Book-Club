애-옹 크로우 

-=20230115

# ECS : Unity ECS, Unity DOTS (초급 강좌) 
동영상보고 최근에 독학했던 DOTS구역을 보완하고자 정리중

---

## -=Object Oriented Design
C++ C# 
상속을 통한 생각의 확장.
우리는 늘 이렇게 개발해왔고, 이방법말고는 딱히 고민해본적이 없어요.

그런데 이방법론은 시간이 지나고 사람이 바뀌고 컨텐츠가 성장하면서 
점점 구조가 복잡해지고, 개선&개편하기가 쉽지않아요

개발이 별로 안 중요해지고 히스토리(역사)가 중요해짐.
왜이랬는지 저랫는지 어쩔수 없다. 꼬여있고 정리할 시간도 없기떄문에 문제가 많다


## -=Data Oriented Design
CPU와 Ram의 성능이 점점 차이가 많이 벌어졋고
결국 CPU가 엄청 놀고 있으니 지금의 프로그래밍 패턴을 바꾸어 
성능을 낼수 있는 방법을 찾기 시작 

2010년이후
CPU의 멀티코어 시대로 들어서면서 무어의법칙이 의미가 없어짐
CPU가 빠르냐 Ram이 빠르냐 의미가 없다.
그냥 CPU가 많기떄문에
Ram이 아무리 빨라져봐야 CPU 10배를 넘어서지는 않을테니까

CPU의 L1,L2,L3캐시 메모리 이런걸 응용해보자고 하는

OOP의 문제점을 개선 복잡도가 줄었으면 좋겠다.

DOD라는게 주목받는 이유로는 언리얼 유니티 둘다 DOTS패턴을 쓰기 떄문에

20230116


-=장점
OOP에서 DOD로 넘어가면 장점으로는 고성능코드, 유지보수
1. 캐쉬활용 =>메모리를 모았다는거
2. 병렬화 => 스레드적용하기 좋다는거
3. 모듈화 => 추가수정할떄 편리
4. 테스트
-=단점
프로그램을 짜는 방식을 전환=>패러다임이 다름
OOP식으로 짠코드들과 함께동작=> 통합하기힘들다


OOP를 다 DOP로 바꾸기 힘드니
OOP에서 DOP디자인으로 바꿀려면
1. 메모리를 따로 Packing해서 모으고
2. 코드를 ForLoop로 돌린다.

-=20230117

메모리만 Packing하면 되네 이게 간단한데
메모리를 모으는게 쉽지않다

메모리를 계속 패킹상태로 유지하는게 어렵다.
언제사라질지 모르니까
그러므로 CPU한테 메모리가 비어있는상태로 던지기가 어렵다

ECS에서 가장중요한게 메모리모델

크게 두종류 
SparseSet(마인크래프트, 오버와치)
Archetype(언리얼, 유니티)

레고처럼 Entitiy = ID

SparseSet은 같은 Stucture 끼리 모아서 처리
정렬이 안되있어서 따로 연산이 필요함




Archetype은 같은 조합의 Stucture형태끼리 모아서 처리

Archetype의 단점은 하나바뀌면 통채로 복사해야됨
뺏다끼었다하는건 상당히 문제가됨

멀티스레드

OOP보다 DOP가 코드보기가 더 쉽다라.. 흠




AOS(Array of Structure)
float x;
float y;
myAos[N];

SOA(Structure of Array)
float x[N];
float y[N];
mySOA;








ECS는 만능이 아님
대규모게임은 좋지만
로그라이크류 게임은 힘듬
이유는 몬스터300종류, 행동수백종류같은
다양성이 문제다
각종류마다 레고블럭을 설치하면 너무 커지지않느냐

어덯게 설계하느냐에 따라 다름


십만개가 나왔다고 십만개를 For 돌리지는 않는다
안에 트리거가 있기때문에


엔티티월드에 신규엔티티를 만든후
해당 엔티티에 컴포넌트들을 붙칙
//이런형식
//Entity 플레이어 = EntityManager.Create();
//플레이어.replace<컴포넌트1>();
//플레이어.replace<컴포넌트2>();
//플레이어.replace<컴포넌트3>();

필요한 Structure들을 Query로 가져온후
Structure값을 이용해 원하는 연산을 System을 통해 갱신



흠.. OOP에 익숙해서그런지 DOP로 이런저런 예시를 말해주는데
오히려 어려워보이는데 아직 퍼즐이 안맞음.



오버와치가 나오는객체가 적어도 DOP로 한 이유는
각각 파츠별로 제작하기에 용이하기 때문에



유니티의 OOP를 DOP로 만드는데에는 엄청 어렵다
그래서 기존의 코드를 아예 못씀
기존의 OOP엔진과는 융합하기가 엄청 힘듬

아키타입은 내부에서 스레드모델을 제공해주기떄문에
프레임워크에서 왠만해선 다 해줌

클라는 아키타입을 권장
서버는 스파스셋을 권장//원하는되로 가능

-=20230118
# ECS : Unity ECS, Unity DOTS (중급 : 실용편 강좌)

DOTS는 URP에서만 돌아감
BuiltIn은 안돌아감


URP->Instancing->SRP Batcher
1. ShaderGraph를 사용

Resource로 들어간 객체는 다 1대1 대응으로 제작해야됨

애니메이션은 Material Property Override를 사용해서 부하없이 처리

Root에서 각각의 엔티티를 작업하게 변경

Root에다 스크립트를 박은후 
각각게임오브젝트들을 들고온후
각각 엔티티를 얻은후

모든걸 제어하고 싶으면 게임오브젝트를 변환시켜서
엔티티로 들고오고 어떤엔티티를 제어할지 모르니
그것을 알려줄려고 특정스트럭쳐를 박아서 데이터를 넘겨줘라
그러면 DOTS가 그 엔티티를 가지고 제어하겠다

직접제어하지못하니까 변환이 필요한것

이렇게 변환하는 작업자체가 대작업인데
이득으로 얻는것은 성능이다. 압도적인 성능

최소100배에서 더높으면 1000배

그거때문에 기존 코드들을 컨벌팅할수있는 코드들을 만들어야된다는 문제점이 있다.

(아 바꾸기는 해야되는데 너무 대작업인데)
기본기능을 알아야 나머지 편의기능을 알수 있다.
적어도 1년을 공부해야된다.


GUID로 가지고 오던 GameObject 주소를 챙겨오던
최종적으로 Entity로 가줘와야됨

오픈월드를 만들려면 SubScene 한개로는 안된다
SubScene은 64k 제한이 있음 64개 세션정도면 최대들고 있을수 있다
디폴트가 있으므로 0을키고 123을 킬수 있고
0을 끌려면 123을 꺼야지 끌수 있다. (규칙)

세션0은 바닥종류
세션 123들은 상황에 맞추어 나무, 건물등 그룹을 나누어 배치






